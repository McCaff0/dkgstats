<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Play&display=swap" rel="stylesheet">
  <title>DKGStats.io</title>
  <meta name="description" content="Real-time statistics on the OriginTrail Decentralised Knowledge Graph.">
  <meta name="keywords" content="OriginTrail, Decentralised Knowledge Graph, DKG, TRAC, DKG analytics, staking APY, TRAC price, knowledge assets, base, gnosis, neuroweb, crypto, OT, blockchain">
  <meta name="author" content="McCaff">
  <meta name="robots" content="index, follow">
  <meta property="og:title" content="DKGStats.io">
  <meta property="og:description" content="Real-time statistics on the OriginTrail Decentralised Knowledge Graph.">
  <meta property="og:image" content="https://dkgstats.io/preview-image.jpg">
  <meta property="og:url" content="https://dkgstats.io">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="DKGStats.io">
  <meta name="twitter:description" content="Real-time statistics on the OriginTrail Decentralised Knowledge Graph.">
  <meta name="twitter:image" content="https://dkgstats.io/preview-image.jpg">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
 
  <link rel="canonical" href="https://dkgstats.io">

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
        html, body {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100vh;
    body {
      font-family: 'Play', sans-serif;
      background: #0a0a0a;
      color: #dadada;
      padding: 20px;
      text-align: center;
      overflow-x: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
}
    
h1 {
  display: none;
}

    .title-image {
      width: 75%;
      max-width: 465px;
      display: block;
      margin: -10px auto -4px auto;
}

    .main-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 8px;
      width: 100%;
}

      .container {
        background: #373737;
        padding: 8px;
        border-radius: 16px;
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        justify-content: center;
        gap: 8px;
        width: fit-content;
        position: relative;
}
    
      .container::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: transparent;
        box-shadow: 0 0 100px rgb(78 78 78 / 40%);
        border-radius: 16px;
        z-index: -1;
}
    
      .stats-box {
        background: #0f0f0f;
        padding: 8px;
        border-radius: 8px;
        width: 88vw;
        max-width: 420px;
        min-width: 420px;

}
      
      .stats-box h3 {
        text-align: center;
        font-size: 20px;
        font-weight: bold;
        text-transform: uppercase;
        margin-bottom: 0;
        color: #c8c2cf;
}
      
      .stats-box p {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 20px;
        font-weight: bold;
        margin: 5px 0;
        color: #c8c2cf;
}
      
      .half-line {
        display: block;
        height: 14px
}
          
      .value-container {
        position: relative;
        width: 200px;
        height: 40px;
}
      
      .number-value {
        position: absolute;
        right: 0;
        top: 50%;
        transform: translateY(-50%);
        text-align: right;
        width: 100%;
}
      
      .percentage-change {
        position: absolute;
        right: 0;
        top: 96%;
        transform: translateY(-50%);
        text-align: right;
        font-size: 16px;
        width: 100%;
}
      
      .positive { color: #1c941c; }
      .negative { color: #c91e1e; }
      .neutral  { color: #a6a6a6; }

      .container.new {
        position: relative;
        
}
      .container.new::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        box-shadow: 0 0 100px rgb(78 78 78 / 40%);
        z-index: -1;
}

.graph-box {
  background: #0f0f0f;
  border-radius: 8px;
  max-width: 420px;
  min-width: 420px;
  height: 251px;
  box-sizing: border-box;
}

.graph-box h3 {
  font-family: 'Play', sans-serif;
  font-size: 18px;
  font-weight: bold;
  text-align: center;
  margin-top: 4px;
  margin-bottom: -5px;
  color: #8a8a8a;
}

</style>

  <!-- Google Analytics Tag -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-16V8B7YWR9"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-16V8B7YWR9');
  </script>
  
</head>
<body>
<img src="https://lh3.googleusercontent.com/d/16GwAKEUG5PDjljSembGyIdm7KfXxvXnW=w1000" alt="DKGStats.io" class="title-image">
<h1>DKGStats.io - Real-Time OriginTrail DKG Statistics</h1>
<div class="main-container">
  <div class="container">
    <div class="stats-box">
      <h3>Current</h3>
      
      <p>
        <span>TRAC Price</span>
        <span class="value-container">
          <span id="tracprice" class="number-value">Loading...</span>
          <span id="pricechange1d" class="percentage-change"></span>
        </span>
      </p>
      
      <p>
        <span>Market Cap</span>
        <span class="value-container">
          <span id="marketcap" class="number-value">Loading...</span>
          <span class="percentage-change"></span>
        </span>
      </p>
      
      <p>
        <span>P/E Ratio</span>
        <span class="value-container">
          <span id="peratio" class="number-value">Loading...</span>
          <span class="percentage-change"></span>
        </span>
      </p>
      
      <span class="half-line"></span>
      
      <p>
        <span>TRAC Staked</span>
        <span class="value-container">
          <span id="tracstaked" class="number-value">Loading...</span>
          <span class="percentage-change"></span>
        </span>
      </p>
      
      <p>
        <span>Staking APY</span>
        <span class="value-container">
          <span id="stakingapy" class="number-value">Loading...</span>
          <span class="percentage-change"></span>
        </span>
      </p>
      
      <h3>28 Day Averages</h3>
      
      <p>
        <span>Annual Spend (USD)</span>
        <span class="value-container">
          <span id="annualspend" class="number-value">Loading...</span>
          <span id="annualspendchange28d" class="percentage-change"></span>
        </span>
      </p>
      
      <p>
        <span>Daily Spend (TRAC)</span>
        <span class="value-container">
          <span id="dailyspend" class="number-value">Loading...</span>
          <span class="percentage-change"></span>
        </span>
      </p>
      
      <p>
        <span>Daily Publishes</span>
        <span class="value-container">
          <span id="dailypublishes" class="number-value">Loading...</span>
          <span id="dailypublisheschange28d" class="percentage-change"></span>
        </span>
      </p>
      
      <span class="half-line"></span>
      
      <p>
        <span>Publish Price (TRAC)</span>
        <span class="value-container">
          <span id="publishpricetrac" class="number-value">Loading...</span>
          <span class="percentage-change"></span>
        </span>
      </p>

      <p>
        <span>Publish Price (USD)</span>
        <span class="value-container">
          <span id="publishpriceusd" class="number-value">Loading...</span>
          <span class="percentage-change"></span>
        </span>
      </p>

      <p>
        <span>Operator Fee</span>
        <span class="value-container">
          <span id="stakingfee" class="number-value">Loading...</span>
          <span class="percentage-change"></span>
        </span>
      </p>
    </div>
    
    <div class="stats-box">
      <p>
        <span>Total KA'S</span>
        <span class="value-container">
          <span id="totalkas" class="number-value">Loading...</span>
          <span id="kas24h" class="percentage-change"></span>
        </span>
      </p>
      <p>
        <span>Total TRAC Spent</span>
        <span class="value-container">
          <span id="totaltracspent" class="number-value">Loading...</span>
          <span id="spend24h" class="percentage-change"></span>
        </span>
      </p>
      <p>
        <span>Active Nodes</span>
        <span class="value-container">
          <span id="activenodes" class="number-value">Loading...</span>
          <span class="percentage-change"></span>
        </span>
      </p>
    </div>
  </div>
  
        <div class="container new">
          <div class="graph-box">
            <h3>TRAC PRICE (90D)</h3>
            <canvas id="PriceChart" style="width:100%; height:100%;"></canvas>
          </div>
          <div class="graph-box">
            <h3>Daily USD Spend (90D)</h3>
            <canvas id="SpendChart" style="width:100%; height:100%;"></canvas>
          </div>
          <div class="graph-box">
            <h3>Daily Publishes (90D)</h3>
            <canvas id="PublishesChart" style="width:100%; height:100%;"></canvas>
          </div>
        </div>

                <div class="container new">
                  <div class="graph-box"></div>
                  <div class="graph-box"></div>
                  <div class="graph-box"></div>
                </div>
              </div>

  
  <script>
    function formatNumber(value, decimals = 0, isCurrency = false) {
      if (value == null || value === '') return 'Loading...';
      let number = Number(value);
      if (isNaN(number)) return value;
      let [integer, decimal] = number.toFixed(decimals).split('.');
      let formattedInteger = integer.replace(/\B(?=(\d{3})+(?!\d))/g, ',');
      return decimal ? formattedInteger + '.' + decimal : formattedInteger;
    }
    
    function formatPercentage(value, period) {
      if (value == null || value === '') return ' ';
      let number = Number(value);
      if (isNaN(number)) return value;
      let sign = number > 0 ? '+' : number < 0 ? '-' : '';
      let className = number > 0 ? 'positive' : number < 0 ? 'negative' : 'neutral';
      let p = Math.abs(number) * 100;
      let formatted;
      if (p < 10) {
        formatted = p.toFixed(2);
      } else if (p < 100) {
        formatted = p.toFixed(1);
      } else {
        formatted = p.toFixed(0);
      }
      return '<span class="' + className + '">' + sign + formatted + '% (' + period + ')</span>';
    }

    function formatNumberChange(value, label = '') {
      if (value == null || value === '') return ' ';
      let number = Number(value);
      if (isNaN(number)) return value;
      
      let sign = number > 0 ? '+' : number < 0 ? '-' : '';
      let className = number > 0 ? 'positive' : number < 0 ? 'negative' : 'neutral';
    
      let [integer, decimal] = Math.abs(number).toFixed(0).split('.');
      let formattedInteger = integer.replace(/\B(?=(\d{3})+(?!\d))/g, ',');
    
      let formattedNumber = decimal ? formattedInteger + '.' + decimal : formattedInteger;
    
      return '<span class="' + className + '">' + sign + formattedNumber + '</span>' + 
             (label ? ' <span class="' + className + '">' + label + '</span>' : '');
      
    }
    function handleData(data) {
      if (!data) return;
      document.getElementById('tracprice').innerText = formatNumber(data.tracprice, 4);
      document.getElementById('marketcap').innerText = formatNumber(data.marketcap, 0, true);
      document.getElementById('peratio').innerText = formatNumber(data.peratio, 1);
      document.getElementById('tracstaked').innerText = formatNumber(data.tracstaked, 0, true);
      document.getElementById('stakingapy').innerText = formatNumber(data.stakingapy * 100, 2) + '%';
      document.getElementById('annualspend').innerText = formatNumber(data.annualspend, 0, true);
      document.getElementById('dailyspend').innerText = formatNumber(data.dailyspend, 0, true);
      document.getElementById('dailypublishes').innerText = formatNumber(data.dailypublishes, 0);
      document.getElementById('publishpricetrac').innerText = formatNumber(data.publishpricetrac, 6);
      document.getElementById('publishpriceusd').innerText = formatNumber(data.publishpriceusd, 6);
      document.getElementById('stakingfee').innerText = formatNumber(data.stakingfee * 100, 2) + '%';
      document.getElementById('totalkas').innerText = formatNumber(data.totalkas, 0)
      document.getElementById('kas24h').innerHTML = formatNumberChange(data.kas24h, '(24H)');
      document.getElementById('totaltracspent').innerText = formatNumber(data.totaltracspent, 0);
      document.getElementById('spend24h').innerHTML = formatNumberChange(data.spend24h, '(24H)');
      document.getElementById('activenodes').innerText = formatNumber(data.activenodes, 0);
      document.getElementById('pricechange1d').innerHTML = formatPercentage(data.pricechange1d, '24H');
      document.getElementById('dailypublisheschange28d').innerHTML = formatPercentage(data.dailypublisheschange28d, '28D');
      document.getElementById('annualspendchange28d').innerHTML = formatPercentage(data.annualspendchange28d, '28D');
    }
    
    function fetchData() {
      const FIREBASE_URL = "https://dkgstats-b5839-default-rtdb.firebaseio.com/data/sheetData.json";
      
      fetch(FIREBASE_URL)
        .then(response => response.json())
        .then(data => handleData(data))
        .catch(error => console.error('Error fetching data:', error));
    }

              let PriceChartInstance = null;
              let SpendChartInstance = null;
              let PublishesChartInstance = null;
              let isFirstDataLoad = true;
              let isFirstSpendLoad = true;
              let isFirstPublishesLoad = true;

function renderPriceChart(priceLabels, priceValues, animate = false) {
    const canvas = document.getElementById('PriceChart');
    if (!canvas) {
        console.error("PriceChart canvas not found!");
        return;
    }
    const ctx = canvas.getContext('2d');

    if (PriceChartInstance) {
        PriceChartInstance.destroy();
    }

    const shouldAnimate = (isFirstDataLoad && priceValues.length > 0) || animate;

    PriceChartInstance = new Chart(ctx, {
        type: 'line',
        data: {
            labels: priceLabels || [],
            datasets: [{
                label: 'Price',
                data: priceValues || [],
                borderColor: 'rgba(146, 176, 174, 1)',
                backgroundColor: 'rgba(146, 176, 174, 0.1)',
                fill: true,
                tension: 0.1,
                pointRadius: 0,
                pointHoverRadius: 5,
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            animation: shouldAnimate ? { duration: 500, easing: 'easeInOutQuad' } : false,
            scales: {
                x: {
                    type: 'time',
                    time: {
                        parser: 'yyyy-MM-dd',
                        unit: 'day',
                        tooltipFormat: 'PP',
                        displayFormats: { day: 'MMM d' }
                    },
                    ticks: {
                        autoSkip: true,
                        maxTicksLimit: 10,
                        callback: function(value) {
                            const date = new Date(value);
                            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                        },
                        font: { family: 'Play, sans-serif' },
                        padding: 0,
                    }
                },
                y: {
                    title: {
                        display: true,
                        text: 'Price (USD)',
                        font: { family: 'Play, sans-serif', size: 14 }
                    },
                    ticks: {
                        beginAtZero: false,
                        font: { family: 'Play, sans-serif' }
                    }
                }
            },
            plugins: {
                legend: { display: false },
                title: { display: false }
            },
            layout: {
                padding: { left: 15, right: 30, top: 0, bottom: 23 }
            }
        }
    });

    if (priceValues.length > 0) {
        isFirstDataLoad = false;
    }
}

function renderSpendChart(spendLabels, spendValues, animate = false) {
    const canvas = document.getElementById('SpendChart');
    if (!canvas) {
        console.error("SpendChart canvas not found!");
        return;
    }
    const ctx = canvas.getContext('2d');

    if (SpendChartInstance) {
        SpendChartInstance.destroy();
    }

    const shouldAnimate = (isFirstSpendLoad && spendValues.length > 0) || animate;

    SpendChartInstance = new Chart(ctx, {
        type: 'line',
        data: {
            labels: spendLabels || [],
            datasets: [{
                label: 'Spend',
                data: spendValues || [],
                borderColor: 'rgba(146, 176, 174, 0.8)',
                backgroundColor: 'rgba(146, 176, 174, 0.1)',
                fill: true,
                tension: 0.1,
                pointRadius: 0,
                pointHoverRadius: 5,
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            animation: shouldAnimate ? { duration: 500, easing: 'easeInOutQuad' } : false,
            scales: {
                x: {
                    type: 'time',
                    time: {
                        parser: 'yyyy-MM-dd',
                        unit: 'day',
                        tooltipFormat: 'PP',
                        displayFormats: { day: 'MMM d' }
                    },
                    ticks: {
                        autoSkip: true,
                        maxTicksLimit: 10,
                        callback: function(value) {
                            const date = new Date(value);
                            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                        },
                        font: { family: 'Play, sans-serif' },
                        padding: 0,
                    }
                },
                y: {
                    title: {
                        display: true,
                        text: 'Spend (USD)',
                        font: { family: 'Play, sans-serif', size: 14 }
                    },
                    ticks: {
                        beginAtZero: false,
                        font: { family: 'Play, sans-serif' },
                        callback: function(value) {
                            return value >= 1000 ? (value / 1000) + 'K' : value;
                        }
                    }
                }
            },
            plugins: {
                legend: { display: false },
                title: { display: false }
            },
            layout: {
                padding: { left: 15, right: 30, top: 0, bottom: 23 }
            }
        }
    });

    if (spendValues.length > 0) {
        isFirstSpendLoad = false;
    }
}

function renderPublishesChart(publishesLabels, publishesValues, animate = false) {
    const canvas = document.getElementById('PublishesChart');
    if (!canvas) {
        console.error("PublishesChart canvas not found!");
        return;
    }
    const ctx = canvas.getContext('2d');

    const hasExistingData = PublishesChartInstance && PublishesChartInstance.data.datasets[0].data.length > 0;
    const firstTimeLoadingRealData = !hasExistingData && publishesValues.length > 0;

    if (!PublishesChartInstance) {
        // **First-time chart creation**
        PublishesChartInstance = new Chart(ctx, {
            type: 'line',
            data: {
                labels: publishesLabels || [],
                datasets: [{
                    label: 'Publishes',
                    data: publishesValues || [],
                    borderColor: 'rgba(146, 176, 174, 0.8)',
                    backgroundColor: 'rgba(146, 176, 174, 0.1)',
                    fill: true,
                    tension: 0.1,
                    pointRadius: 0,
                    pointHoverRadius: 5,
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                animation: firstTimeLoadingRealData ? {} : false,  // **Only animate the first real data load**
                scales: {
                    x: {
                        type: 'time',
                        time: {
                            parser: 'yyyy-MM-dd',
                            unit: 'day',
                            tooltipFormat: 'PP',
                            displayFormats: { day: 'MMM d' }
                        },
                        ticks: {
                            autoSkip: true,
                            maxTicksLimit: 10,
                            font: { family: 'Play, sans-serif' },
                            padding: 0,
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Publishes',
                            font: { family: 'Play, sans-serif', size: 14 }
                        },
                        ticks: {
                            beginAtZero: false,
                            font: { family: 'Play, sans-serif' },
                            callback: function(value) {
                                return value >= 1000000 ? (value / 1000000) + 'M' : value;
                            }
                        }
                    }
                },
                plugins: {
                    legend: { display: false },
                    title: { display: false }
                },
                layout: {
                    padding: { left: 15, right: 30, top: 0, bottom: 23 }
                }
            }
        });
    } else {
        // **Prevent animation when updating from an empty chart**
        const animationConfig = firstTimeLoadingRealData ? {} : false;

        PublishesChartInstance.data.labels = publishesLabels;
        PublishesChartInstance.data.datasets[0].data = publishesValues;

        PublishesChartInstance.update({ animation: animationConfig });
    }

    if (publishesValues.length > 0) {
        isFirstPublishesLoad = false;
    }
}
function fetchChartData() {
    let hasSuccessfulFetch = false;

    const CHART_DATA_BASE_URL = 'https://dkgstats-b5839-default-rtdb.firebaseio.com//data/charts';

    fetch(CHART_DATA_BASE_URL + '/price.json')
        .then(response => response.json())
        .then(data => {
            console.log("Price Data:", data);

            if (Array.isArray(data) && data.length > 0) {
                const priceLabels = data.map(item => item.date);
                const priceValues = data.map(item => item.value);
                renderPriceChart(priceLabels, priceValues, isFirstDataLoad);
                hasSuccessfulFetch = true;
            } else {
                console.warn("No valid price data received.");
            }
        })
        .catch(error => {
            console.error("Error fetching price data:", error);
        });

    fetch(CHART_DATA_BASE_URL + '/spend.json')
        .then(response => response.json())
        .then(data => {
            console.log("Spend Data:", data);

            if (Array.isArray(data) && data.length > 0) {
                const spendLabels = data.map(item => item.date);
                const spendValues = data.map(item => item.value);
                renderSpendChart(spendLabels, spendValues, isFirstSpendLoad);
                hasSuccessfulFetch = true;
            } else {
                console.warn("No valid spend data received.");
            }
        })
        .catch(error => {
            console.error("Error fetching spend data:", error);
        });

    fetch(CHART_DATA_BASE_URL + '/publishes.json')
        .then(response => response.json())
        .then(data => {
            console.log("Publishes Data:", data);

            if (Array.isArray(data) && data.length > 0) {
                const publishesLabels = data.map(item => item.date);
                const publishesValues = data.map(item => item.value);
                renderPublishesChart(publishesLabels, publishesValues, isFirstPublishesLoad);
                hasSuccessfulFetch = true;
            } else {
                console.warn("No valid publishes data received.");
            }
        })
        .catch(error => {
            console.error("Error fetching publishes data:", error);
        });
}

let initialScaleFactor = null; // Store initial scale factor
let scaleApplied = false; // Prevents unnecessary recalculations

function isMobileDevice() {
    return window.innerWidth < 768; // Checks if the device is mobile based on width
}

function adjustScale(force = false) {
    if (scaleApplied && !force) return; // Prevent multiple recalculations unless forced

    const globalScaleFactor = 1.05; // Desktop scale
    let scaleFactor;

    if (isMobileDevice()) {
        const mobileReferenceWidth = 500; // Mobile reference width
        const currentWidth = window.innerWidth;
        scaleFactor = currentWidth / mobileReferenceWidth; // Calculate mobile scale

        // 🚨 Prevent micro-differences by keeping the first calculated scale
        if (initialScaleFactor === null) {
            initialScaleFactor = scaleFactor;
        } else {
            scaleFactor = initialScaleFactor; // Use the stored value for consistency
        }

        document.body.style.transform = `scale(${scaleFactor})`;
        document.body.style.transformOrigin = "top center";
        document.body.style.height = (window.innerHeight / scaleFactor) + "px";
    } else {
        const referenceWidth = 2048; // Desktop reference width
        const currentWidth = window.innerWidth;
        scaleFactor = (currentWidth / referenceWidth) * globalScaleFactor; // Desktop scale factor

        if (initialScaleFactor === null) {
            initialScaleFactor = scaleFactor;
        } else {
            scaleFactor = initialScaleFactor;
        }

        document.body.style.transform = `scale(${scaleFactor})`;
        document.body.style.transformOrigin = "top center";
        document.body.style.height = (window.innerHeight / scaleFactor) + "px";
    }

    scaleApplied = true; // Mark scale as applied
}

// Ensure resizing doesn't mess up scaling
window.addEventListener("resize", () => {
    scaleApplied = false;
    setTimeout(() => adjustScale(true), 50); // Reapply scale with the stored factor
});

// Apply scale only **after** charts/data are loaded
function fetchDataAndApplyScale() {
    fetchChartData(); // Fetch data
    setTimeout(adjustScale, 200); // Apply scale after loading content
}

// 🚀 Ensure scale applies consistently
adjustScale();

    renderPriceChart([], [], false);
    renderSpendChart([], [], false);
    renderPublishesChart([], [], false);
    fetchChartData();
    fetchData();
    
let dataInterval, chartInterval;

function startIntervals() {
    if (dataInterval) clearInterval(dataInterval);
    if (chartInterval) clearInterval(chartInterval);

    // Set new intervals
    dataInterval = setInterval(() => fetchData(), 10000);
    chartInterval = setInterval(() => fetchChartData(), 60000);
}

startIntervals();

  </script>
  
</body>
</html>
